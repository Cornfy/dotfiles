#!/bin/bash
# 文件搜索脚本 (rg + fzf)，支持排除目录
# 支持相对路径（node_modules/）和绝对路径（/home/elysia/Apps）

# ===== 配置要排除的目录 =====
EXCLUDES=(
  ".git"
  "node_modules"
  "dist"
  "__pycache__"
  "/home/elysia/Games/umu/prefixes"
)

# ===== 构造 ripgrep 参数 =====
RG_EXCLUDES=()
for path in "${EXCLUDES[@]}"; do
  expanded=$(eval echo "$path")   # 展开 ~
  if [[ "$expanded" = /* ]]; then
    # 如果是绝对路径 → 转换为相对路径（基于当前工作目录）
    rel=$(realpath --relative-to="$(pwd)" "$expanded" 2>/dev/null || echo "$expanded")
    RG_EXCLUDES+=("--glob=!$rel")
  else
    # 相对路径直接用
    RG_EXCLUDES+=("--glob=!$expanded")
  fi
done

# ===== 执行搜索 =====
rg --files "${RG_EXCLUDES[@]}" | fzf

